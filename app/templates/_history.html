{% if not partial %}
<div class="modal fade show" style="display:block;" tabindex="-1" aria-modal="true" role="dialog">
  <div class="modal-dialog modal-dialog-centered modal-xl">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">History — {{ player_name }}</h5>
        <button type="button" class="btn-close" aria-label="Close" onclick="this.closest('.modal').remove()"></button>
      </div>
      <div class="modal-body">
        {% if items and items|length > 0 %}
        <div class="table-responsive">
          <table class="table table-sm align-middle">
            <thead>
              <tr>
                <th>Date</th><th>Time</th>
                <th class="text-center">Letter</th><th>Theme</th>
                <th class="text-end">Score</th><th class="text-end">Attempts</th><th class="text-end">Acc</th>
                <th class="text-end">WPM</th><th class="text-end">Avg Len</th>
                <th>Words</th>
              </tr>
            </thead>
            <tbody id="historyRows">
              {% for row in items %}
                <tr>
                  <td>{{ row.date }}</td>
                  <td>{{ row.time }}</td>
                  <td class="text-center"><span class="badge text-bg-secondary">{{ row.letter }}</span></td>
                  <td>{{ row.theme }}</td>
                  <td class="text-end">{{ row.score }}</td>
                  <td class="text-end">{{ row.attempts }}</td>
                  <td class="text-end">{{ row.acc }}%</td>
                  <td class="text-end">{{ row.wpm }}</td>
                  <td class="text-end">{{ row.avg_len }}</td>
                  <td style="max-width:360px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis" title="{{ row.words|join(', ') }}">
                    {{ row.words|join(', ') }}
                  </td>
                </tr>
              {% endfor %}
            </tbody>
          </table>
        </div>

        <div id="historyMore" class="d-flex justify-content-center mt-2">
          {% if next_page %}
            <button class="btn btn-outline-primary"
                    hx-get="/history?page={{ next_page }}&partial=1"
                    hx-target="#historyRows"
                    hx-swap="beforeend">
              Load more
            </button>
          {% else %}
            <div class="text-muted small">End of results</div>
          {% endif %}
        </div>
        {% else %}
          <div class="alert alert-secondary mb-0">No runs yet — play a round!</div>
        {% endif %}
      </div>
      <div class="modal-footer">
        <button class="btn btn-primary" onclick="this.closest('.modal').remove()">Close</button>
      </div>
    </div>
  </div>
</div>
{% else %}
  {# --- PARTIAL mode: just rows, plus an out-of-band replacement for the "Load more" control --- #}
  {% for row in items %}
    <tr>
      <td>{{ row.date }}</td>
      <td>{{ row.time }}</td>
      <td class="text-center"><span class="badge text-bg-secondary">{{ row.letter }}</span></td>
      <td>{{ row.theme }}</td>
      <td class="text-end">{{ row.score }}</td>
      <td class="text-end">{{ row.attempts }}</td>
      <td class="text-end">{{ row.acc }}%</td>
      <td class="text-end">{{ row.wpm }}</td>
      <td class="text-end">{{ row.avg_len }}</td>
      <td style="max-width:360px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis" title="{{ row.words|join(', ') }}">
        {{ row.words|join(', ') }}
      </td>
    </tr>
  {% endfor %}

  <div id="historyMore" hx-swap-oob="true" class="d-flex justify-content-center mt-2">
    {% if next_page %}
      <button class="btn btn-outline-primary"
              hx-get="/history?page={{ next_page }}&partial=1"
              hx-target="#historyRows"
              hx-swap="beforeend">
        Load more
      </button>
    {% else %}
      <div class="text-muted small">End of results</div>
    {% endif %}
  </div>
{% endif %}
